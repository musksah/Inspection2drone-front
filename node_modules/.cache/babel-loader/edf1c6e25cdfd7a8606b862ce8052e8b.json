{"remainingRequest":"/home/sebastian/Documentos/inspection2drone/DjInspection2drone/front/node_modules/babel-loader/lib/index.js!/home/sebastian/Documentos/inspection2drone/DjInspection2drone/front/src/store.js","dependencies":[{"path":"/home/sebastian/Documentos/inspection2drone/DjInspection2drone/front/src/store.js","mtime":1589558848406},{"path":"/home/sebastian/Documentos/inspection2drone/DjInspection2drone/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/sebastian/Documentos/inspection2drone/DjInspection2drone/front/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport axios from 'axios';\nimport VueAxios from 'vue-axios';\nimport jwt_decode from 'jwt-decode';\nimport Vuex from 'vuex';\nVue.use(Vuex);\nVue.use(VueAxios, axios);\nexport const store = new Vuex.Store({\n  state: {\n    jwt: localStorage.getItem('t'),\n    username: localStorage.getItem('username'),\n    endpoints: {\n      obtainJWT: 'http://127.0.0.1:8000/api/v1.0/auth/obtain_token/',\n      refreshJWT: 'http://127.0.0.1:8000/api/v1.0/auth/refresh_token/'\n    },\n    permissions: localStorage.getItem('permissions'),\n    modules: localStorage.getItem('modules'),\n    info_modules: {\n      'view_dashboard': {\n        name: \"Dashboard\",\n        route: \"dashboard\",\n        icon: \"ti-dashboard\"\n      },\n      'view_user': {\n        name: \"Users\",\n        route: \"users\",\n        icon: \"ti-user\"\n      },\n      'view_inspection': {\n        name: \"Inspecciones\",\n        route: \"inspection\",\n        icon: \"ti-calendar\"\n      },\n      'view_company': {\n        name: \"Compañías\",\n        route: \"company\",\n        icon: \"ti-briefcase\"\n      },\n      'view_plan': {\n        name: \"Planes\",\n        route: \"plans\",\n        icon: \"ti-notepad\"\n      },\n      'view_image': {\n        name: \"Galería\",\n        route: \"gallery\",\n        icon: \"ti-gallery\"\n      },\n      'add_image': {\n        name: \"Cargar Imágenes\",\n        route: \"upload-photo\",\n        icon: \"ti-gallery\"\n      },\n      'view_pilot': {\n        name: \"Pilotos\",\n        route: \"pilot\",\n        icon: \"ti-id-badge\"\n      },\n      'view_profile': {\n        name: \"profile\",\n        route: \"profile\",\n        icon: \"ti-id-badge\"\n      },\n      'view_drone': {\n        name: \"Drones\",\n        route: \"drones\",\n        icon: \"ti-vector\"\n      },\n      'view_analysis': {\n        name: \"Análisis\",\n        route: \"analysis\",\n        icon: \"ti-briefcase\"\n      }\n    }\n  },\n  getters: {\n    getBaseInstanceAxios: state => {\n      return {\n        baseURL: \"http://127.0.0.1:8000/api/v1.0/\",\n        headers: {\n          Authorization: `JWT ${state.jwt}`,\n          \"Content-Type\": \"application/json\"\n        },\n        xhrFields: {\n          withCredentials: true\n        }\n      };\n    },\n    getModules: state => {\n      let modules_new = [];\n      JSON.parse(state.modules).forEach(element => {\n        console.log(element);\n\n        if (state.info_modules.hasOwnProperty(element)) {\n          modules_new.push(state.info_modules[element]);\n        }\n      });\n      return modules_new;\n    }\n  },\n  mutations: {\n    updateToken(state, newToken) {\n      localStorage.setItem('t', newToken);\n      state.jwt = newToken;\n    },\n\n    removeToken(state) {\n      localStorage.removeItem('t');\n      state.jwt = null;\n    },\n\n    updateUsername(state, username) {\n      localStorage.setItem('username', username);\n      state.username = username;\n    },\n\n    storePermissions(state, permissions) {\n      state.permissions = [];\n      let arr_modules = [];\n      permissions.forEach(element => {\n        state.permissions.push(element.fields.codename);\n      });\n      localStorage.setItem('permissions', JSON.stringify(state.permissions));\n      arr_modules = state.permissions.filter(function (perm) {\n        return perm.includes(\"view\") || perm.includes(\"add\");\n      });\n      state.modules = JSON.stringify(arr_modules);\n      localStorage.setItem('modules', JSON.stringify(arr_modules));\n    }\n\n  },\n  actions: {\n    obtainToken(context, credentials) {\n      const payload = {\n        username: credentials.username,\n        password: credentials.password\n      };\n      return axios.post(this.state.endpoints.obtainJWT, payload);\n    },\n\n    refreshToken() {\n      const payload = {\n        token: this.state.jwt\n      };\n      axios.post(this.state.endpoints.refreshJWT, payload).then(response => {\n        this.commit('updateToken', response.data.token);\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    inspectToken() {\n      // WE WILL ADD THIS LATER\n      const token = this.state.jwt;\n\n      if (token) {\n        const decoded = jwt_decode(token);\n        const exp = decoded.exp;\n        const orig_iat = decode.orig_iat;\n\n        if (exp - Date.now() / 1000 < 1800 && Date.now() / 1000 - orig_iat < 628200) {\n          this.dispatch('refreshToken');\n        } else if (exp - Date.now() / 1000 < 1800) {// DO NOTHING, DO NOT REFRESH          \n        } else {// PROMPT USER TO RE-LOGIN, THIS ELSE CLAUSE COVERS THE CONDITION WHERE A TOKEN IS EXPIRED AS WELL\n          }\n      }\n    } // WE WILL ADD THIS LATER\n\n\n  }\n});",{"version":3,"sources":["/home/sebastian/Documentos/inspection2drone/DjInspection2drone/front/src/store.js"],"names":["Vue","axios","VueAxios","jwt_decode","Vuex","use","store","Store","state","jwt","localStorage","getItem","username","endpoints","obtainJWT","refreshJWT","permissions","modules","info_modules","name","route","icon","getters","getBaseInstanceAxios","baseURL","headers","Authorization","xhrFields","withCredentials","getModules","modules_new","JSON","parse","forEach","element","console","log","hasOwnProperty","push","mutations","updateToken","newToken","setItem","removeToken","removeItem","updateUsername","storePermissions","arr_modules","fields","codename","stringify","filter","perm","includes","actions","obtainToken","context","credentials","payload","password","post","refreshToken","token","then","response","commit","data","catch","error","inspectToken","decoded","exp","orig_iat","decode","Date","now","dispatch"],"mappings":"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","sourcesContent":["import Vue from 'vue';\nimport axios from 'axios'\nimport VueAxios from 'vue-axios'\nimport jwt_decode from 'jwt-decode'\nimport Vuex from 'vuex'\nVue.use(Vuex);\nVue.use(VueAxios, axios);\n\nexport const store = new Vuex.Store({\n    state: {\n        jwt: localStorage.getItem('t'),\n        username: localStorage.getItem('username'),\n        endpoints: {\n            obtainJWT: 'http://127.0.0.1:8000/api/v1.0/auth/obtain_token/',\n            refreshJWT: 'http://127.0.0.1:8000/api/v1.0/auth/refresh_token/'\n        },\n        permissions: localStorage.getItem('permissions'),\n        modules: localStorage.getItem('modules'),\n        info_modules: {\n            'view_dashboard': {\n                name: \"Dashboard\",\n                route: \"dashboard\",\n                icon: \"ti-dashboard\"\n            },\n            'view_user': {\n                name: \"Users\",\n                route: \"users\",\n                icon: \"ti-user\"\n            },\n            'view_inspection': {\n                name: \"Inspecciones\",\n                route: \"inspection\",\n                icon: \"ti-calendar\"\n            },\n            'view_company': {\n                name: \"Compañías\",\n                route: \"company\",\n                icon: \"ti-briefcase\"\n            },\n            'view_plan': {\n                name: \"Planes\",\n                route: \"plans\",\n                icon: \"ti-notepad\"\n            },\n            'view_image': {\n                name: \"Galería\",\n                route: \"gallery\",\n                icon: \"ti-gallery\"\n            },\n            'add_image': {\n                name: \"Cargar Imágenes\",\n                route: \"upload-photo\",\n                icon: \"ti-gallery\"\n            },\n            'view_pilot': {\n                name: \"Pilotos\",\n                route: \"pilot\",\n                icon: \"ti-id-badge\"\n            },\n            'view_profile': {\n                name: \"profile\",\n                route: \"profile\",\n                icon: \"ti-id-badge\"\n            },\n            'view_drone': {\n                name: \"Drones\",\n                route: \"drones\",\n                icon: \"ti-vector\"\n            },\n            'view_analysis': {\n                name: \"Análisis\",\n                route: \"analysis\",\n                icon: \"ti-briefcase\"\n            },\n        }\n    },\n    getters: {\n        getBaseInstanceAxios: state => {\n            return {\n                baseURL: \"http://127.0.0.1:8000/api/v1.0/\",\n                headers: {\n                    Authorization: `JWT ${state.jwt}`,\n                    \"Content-Type\": \"application/json\"\n                },\n                xhrFields: {\n                    withCredentials: true\n                }\n            };\n        },\n        getModules: state => {\n            let modules_new = []\n            JSON.parse(state.modules).forEach(element => {\n                console.log(element);\n                if (state.info_modules.hasOwnProperty(element)) {\n                    modules_new.push(state.info_modules[element]);\n                }\n            });\n            return modules_new;\n        }\n    },\n    mutations: {\n        updateToken(state, newToken) {\n            localStorage.setItem('t', newToken);\n            state.jwt = newToken;\n        },\n        removeToken(state) {\n            localStorage.removeItem('t');\n            state.jwt = null;\n        },\n        updateUsername(state, username) {\n            localStorage.setItem('username', username);\n            state.username = username;\n        },\n        storePermissions(state, permissions) {\n            state.permissions = []\n            let arr_modules = []\n            permissions.forEach(element => {\n                state.permissions.push(element.fields.codename)\n            });\n            localStorage.setItem('permissions', JSON.stringify(state.permissions))\n            arr_modules = state.permissions.filter(function (perm) {\n                return perm.includes(\"view\") || perm.includes(\"add\");\n            });\n            state.modules = JSON.stringify(arr_modules);\n            localStorage.setItem('modules', JSON.stringify(arr_modules));\n        }\n    },\n    actions: {\n        obtainToken(context, credentials) {\n            const payload = {\n                username: credentials.username,\n                password: credentials.password\n            }\n            return axios.post(this.state.endpoints.obtainJWT, payload);\n        },\n        refreshToken() {\n            const payload = {\n                token: this.state.jwt\n            }\n            axios.post(this.state.endpoints.refreshJWT, payload)\n                .then((response) => {\n                    this.commit('updateToken', response.data.token)\n                })\n                .catch((error) => {\n                    console.log(error)\n                })\n        },\n        inspectToken() {\n            // WE WILL ADD THIS LATER\n            const token = this.state.jwt;\n            if (token) {\n                const decoded = jwt_decode(token);\n                const exp = decoded.exp\n                const orig_iat = decode.orig_iat\n                if (exp - (Date.now() / 1000) < 1800 && (Date.now() / 1000) - orig_iat < 628200) {\n                    this.dispatch('refreshToken')\n                } else if (exp - (Date.now() / 1000) < 1800) {\n                    // DO NOTHING, DO NOT REFRESH          \n                } else {\n                    // PROMPT USER TO RE-LOGIN, THIS ELSE CLAUSE COVERS THE CONDITION WHERE A TOKEN IS EXPIRED AS WELL\n                }\n            }\n        }\n        // WE WILL ADD THIS LATER\n    }\n});"]}]}